//#region src/plugins/extraction.d.ts
interface ExtractedElement extends ElementNode {
  textContent: string;
}
declare function extractionPlugin(selectors: Record<string, (element: ExtractedElement, state: MdreamRuntimeState) => void>): Plugin;
//#endregion
//#region src/types.d.ts
/**
 * Plugin interface for extending HTML to Markdown conversion
 */
interface Plugin {
  /**
   * Process a node before it's handled by the parser
   */
  beforeNodeProcess?: (event: NodeEvent, state: MdreamRuntimeState) => undefined | void | {
    skip: boolean;
  };
  /**
   * Hook that runs when entering a node
   * @returns String to add to the output, or PluginHookResult with content
   */
  onNodeEnter?: (node: ElementNode, state: MdreamRuntimeState) => string | undefined | void;
  /**
   * Hook that runs when exiting a node
   * @param event - The node event
   * @param state - The current runtime state
   * @returns String to add to the output, or PluginHookResult with content
   */
  onNodeExit?: (node: ElementNode, state: MdreamRuntimeState) => string | undefined | void;
  /**
   * Process attributes for a node
   * @param node - The node to process attributes for
   * @param state - The current runtime state
   */
  processAttributes?: (node: ElementNode, state: MdreamRuntimeState) => void;
  /**
   * Process a text node before it's added to the output
   * @param node - The text node to process
   * @param state - The current runtime state
   * @returns Result with content and skip flag, or undefined for no transformation
   */
  processTextNode?: (node: TextNode, state: MdreamRuntimeState) => {
    content: string;
    skip: boolean;
  } | undefined;
}
/**
 * Plugin creation options for controlling plugin behavior
 */
interface PluginCreationOptions {
  /**
   * Order in which plugins are executed
   * Lower numbers run first
   */
  order?: number;
  /**
   * Priority for region conflict resolution
   * Higher numbers take precedence over lower
   */
  priority?: number;
}
interface HTMLToMarkdownOptions {
  /**
   * Origin URL for resolving relative image paths and internal links.
   * Important when converting HTML with relative paths from a specific website.
   */
  origin?: string;
  /**
   * Plugins to extend HTML to Markdown conversion
   */
  plugins?: Plugin[];
}
declare const ELEMENT_NODE = 1;
declare const TEXT_NODE = 3;
interface ElementNode extends Node {
  /** Element tag name (for ELEMENT_NODE) */
  name: string;
  /** HTML attributes (for ELEMENT_NODE) */
  attributes: Record<string, string>;
  /** Custom data added by plugins */
  context?: PluginContext;
  /** ID of the tag for fast handler lookup */
  tagId?: number;
  /** Map of tag names to their nesting count (using Uint8Array for performance) */
  depthMap: Uint8Array;
  /** Plugin outputs collected during processing */
  pluginOutput?: string[];
}
interface TextNode extends Node {
  /** Text content (for TEXT_NODE) */
  value: string;
  /** Custom data added by plugins */
  context?: PluginContext;
  /** Whether this text node should be excluded from markdown output (for script/style elements) */
  excludedFromMarkdown?: boolean;
}
/**
 * Base DOM node interface
 * Optimized for streaming HTML parsing with minimal memory footprint
 */
interface Node {
  /** Node type (ELEMENT_NODE or TEXT_NODE) */
  type: number;
  /** Current nesting depth in the DOM tree */
  depth: number;
  /** Node exclusion and filtering now handled by plugins */
  /** Index of this node within its parent's children */
  index: number;
  /** Current walk index for child traversal during streaming */
  currentWalkIndex?: number;
  /** Count of text child nodes - used for whitespace handling */
  childTextNodeIndex?: number;
  /** Whether node contains whitespace - used for whitespace optimization */
  containsWhitespace?: boolean;
  /** Cached reference to tag handler for performance */
  tagHandler?: TagHandler;
  /** Parent node */
  parent?: ElementNode | null;
  /** Custom data added by plugins */
  context?: PluginContext;
  /** Region ID for buffer region tracking */
  regionId?: number;
}
/**
 * Buffer region for tracking content inclusion/exclusion
 */
interface BufferRegion {
  /** Unique identifier */
  id: number;
  /** Inclusion state */
  include: boolean;
}
/**
 * State interface for HTML parsing and processing
 * Contains parsing state that's maintained during HTML traversal
 */
interface MdreamProcessingState {
  /** Map of tag names to their current nesting depth - uses TypedArray for performance */
  depthMap: Uint8Array;
  /** Current overall nesting depth */
  depth: number;
  /** Currently processing element node */
  currentNode?: ElementNode | null;
  /** Node filtering and exclusion is now handled by plugins */
  /** Whether current content contains HTML entities that need decoding */
  hasEncodedHtmlEntity?: boolean;
  /** Whether the last processed character was whitespace - for collapsing whitespace */
  lastCharWasWhitespace?: boolean;
  /** Whether the last processed buffer has whitespace - optimization flag */
  textBufferContainsWhitespace?: boolean;
  /** Whether the last processed buffer contains non-whitespace characters */
  textBufferContainsNonWhitespace?: boolean;
  /** Whether a tag was just closed - affects whitespace handling */
  justClosedTag?: boolean;
  /** Whether the next text node is the first in its element - for whitespace trimming */
  isFirstTextInElement?: boolean;
  /** Reference to the last processed text node - for context tracking */
  lastTextNode?: Node;
  /** Quote state tracking for non-nesting tags - avoids backward scanning */
  inSingleQuote?: boolean;
  inDoubleQuote?: boolean;
  inBacktick?: boolean;
  /** Backslash escaping state tracking - avoids checking previous character */
  lastCharWasBackslash?: boolean;
  /** Plugin instances array for efficient iteration */
  plugins?: Plugin[];
  /** Configuration options for conversion */
  options?: HTMLToMarkdownOptions;
}
/**
 * Runtime state for markdown generation
 * Extended state that includes output tracking and options
 */
interface MdreamRuntimeState extends Partial<MdreamProcessingState> {
  /** Number of newlines at end of most recent output */
  lastNewLines?: number;
  /** Configuration options for conversion */
  options?: HTMLToMarkdownOptions;
  /** Table processing state - specialized for Markdown tables */
  tableRenderedTable?: boolean;
  tableCurrentRowCells?: number;
  tableColumnAlignments?: string[];
  /** Plugin instances array for efficient iteration */
  plugins?: Plugin[];
  /** Map of region IDs to buffer regions for O(1) lookups */
  regionToggles: Map<number, boolean>;
  /** Content buffers for regions */
  regionContentBuffers: Map<number, string[]>;
  /** Performance cache for last content to avoid iteration */
  lastContentCache?: string;
  /** Reference to the last processed node */
  lastNode?: Node;
  context?: PluginContext;
}
type NodeEventEnter = 0;
type NodeEventExit = 1;
/**
 * Node event for DOM traversal
 * Used in the event-based traversal system for streaming processing
 */
interface NodeEvent {
  /** Event type - enter (start tag) or exit (end tag) */
  type: NodeEventEnter | NodeEventExit;
  /** The node being processed */
  node: Node;
}
/**
 * Handler context for markdown conversion
 * Passed to tag handler functions for converting specific elements
 */
interface HandlerContext {
  /** Current node being processed */
  node: ElementNode;
  /** Parent node (if any) */
  parent?: ElementNode;
  /** Runtime state */
  state: MdreamRuntimeState;
}
/**
 * Tag handler interface for HTML elements
 * Used by plugins to extend or customize tag handling
 */
interface TagHandler {
  enter?: (context: HandlerContext) => string | undefined | void;
  exit?: (context: HandlerContext) => string | undefined | void;
  isSelfClosing?: boolean;
  isNonNesting?: boolean;
  collapsesInnerWhiteSpace?: boolean;
  isInline?: boolean;
  spacing?: readonly [number, number];
  excludesTextNodes?: boolean;
}
interface ReadabilityContext {
  score?: number;
  tagCount?: number;
  linkTextLength?: number;
  textLength?: number;
  isHighLinkDensity?: boolean;
}
interface TailwindContext {
  hidden?: boolean;
  prefix?: string;
  suffix?: string;
}
interface PluginContext {
  score?: number;
  tagCount?: number;
  linkTextLength?: number;
  textLength?: number;
  isHighLinkDensity?: boolean;
  tailwind?: TailwindContext;
  [key: string]: unknown;
}
/**
 * Markdown chunk with content and metadata
 * Compatible with LangChain Document structure
 */
interface MarkdownChunk {
  /** The markdown content of the chunk */
  content: string;
  /** Metadata extracted during chunking */
  metadata: {
    /** Header hierarchy at this chunk position */
    headers?: Record<string, string>;
    /** Code block language if chunk is/contains code */
    code?: string;
    /** Line number range in original document */
    loc?: {
      lines: {
        from: number;
        to: number;
      };
    };
  };
}
/**
 * Options for HTML to Markdown chunking
 * Extends HTMLToMarkdownOptions with chunking-specific settings
 */
interface SplitterOptions extends HTMLToMarkdownOptions {
  /**
   * Header tag IDs to split on (TAG_H1, TAG_H2, etc.)
   * @example [TAG_H1, TAG_H2]
   * @default [TAG_H2, TAG_H3, TAG_H4, TAG_H5, TAG_H6]
   */
  headersToSplitOn?: number[];
  /**
   * Return each line as individual chunk
   * @default false
   */
  returnEachLine?: boolean;
  /**
   * Strip headers from chunk content
   * @default true
   */
  stripHeaders?: boolean;
  /**
   * Maximum chunk size
   * @default 1000
   */
  chunkSize?: number;
  /**
   * Overlap between chunks for context preservation
   * @default 200
   */
  chunkOverlap?: number;
  /**
   * Function to measure chunk length (default: character count)
   * Can be replaced with token counter for LLM applications
   * @default (text) => text.length
   */
  lengthFunction?: (text: string) => number;
  /**
   * Keep separators in the split chunks
   * @default false
   */
  keepSeparator?: boolean;
}
//#endregion
export { TagHandler as _, HandlerContext as a, ExtractedElement as b, MdreamRuntimeState as c, Plugin as d, PluginContext as f, TEXT_NODE as g, SplitterOptions as h, HTMLToMarkdownOptions as i, Node as l, ReadabilityContext as m, ELEMENT_NODE as n, MarkdownChunk as o, PluginCreationOptions as p, ElementNode as r, MdreamProcessingState as s, BufferRegion as t, NodeEvent as u, TailwindContext as v, extractionPlugin as x, TextNode as y };