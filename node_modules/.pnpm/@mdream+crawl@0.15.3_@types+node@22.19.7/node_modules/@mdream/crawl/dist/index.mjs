import { t as crawlAndGenerate } from "./_chunks/crawl.mjs";
import { writeFile } from "node:fs/promises";
import { basename, sep } from "pathe";

//#region src/llms-txt.ts
async function generateLlmsTxt(options) {
	const { siteName, description, results, outputPath } = options;
	let content = `# ${siteName}\n\n`;
	if (description) content += `> ${description}\n\n`;
	if (results.length > 0) {
		content += `## Pages\n\n`;
		for (const result of results) {
			let title;
			try {
				title = result.title || new URL(result.url).pathname;
			} catch {
				title = result.title || result.url;
			}
			if (result.filePath) {
				const mdSeparator = `${sep}md${sep}`;
				const mdIndex = result.filePath.indexOf(mdSeparator);
				const linkPath = (mdIndex !== -1 ? result.filePath.substring(mdIndex + mdSeparator.length) : basename(result.filePath)).split(sep).join("/");
				content += `- [${title}](md/${linkPath}): ${result.url}\n`;
			} else {
				const description$1 = result.metadata?.description ? result.metadata.description.split("\n")[0].substring(0, 100) + (result.metadata.description.length > 100 ? "..." : "") : "";
				content += `- [${title}](${result.url})${description$1 ? `: ${description$1}` : ""}\n`;
			}
		}
	}
	await writeFile(outputPath, content, "utf-8");
}
async function generateLlmsFullTxt(options) {
	const { siteName, description, results, outputPath } = options;
	let content = `# ${siteName}\n\n`;
	if (description) content += `> ${description}\n\n`;
	if (results.length > 0) {
		content += `## Table of Contents\n\n`;
		for (const result of results) {
			let title;
			try {
				title = result.title || new URL(result.url).pathname;
			} catch {
				title = result.title || result.url;
			}
			const anchor = title.toLowerCase().replace(/[^a-z0-9]/g, "-");
			content += `- [${title}](#${anchor})\n`;
		}
		content += `\n---\n\n`;
		for (const result of results) {
			let title;
			try {
				title = result.title || new URL(result.url).pathname;
			} catch {
				title = result.title || result.url;
			}
			content += `## ${title}\n\n`;
			content += `**URL:** ${result.url}\n\n`;
			content += `${result.content}\n\n---\n\n`;
		}
	}
	await writeFile(outputPath, content, "utf-8");
}

//#endregion
export { crawlAndGenerate, generateLlmsFullTxt, generateLlmsTxt };