{"version":3,"file":"agents.mjs","names":[],"sources":["../src/agents.ts"],"sourcesContent":["/**\n * Agent detection and skill installation\n * Writes directly to agent skill directories in the project\n */\n\nimport { existsSync, mkdirSync, writeFileSync } from 'node:fs'\nimport { join } from 'node:path'\nimport { homedir } from 'node:os'\n\nconst home = homedir()\nconst configHome = process.env.XDG_CONFIG_HOME || join(home, '.config')\nconst claudeHome = process.env.CLAUDE_CONFIG_DIR || join(home, '.claude')\nconst codexHome = process.env.CODEX_HOME || join(home, '.codex')\n\nexport type AgentType =\n  | 'claude-code'\n  | 'cursor'\n  | 'windsurf'\n  | 'cline'\n  | 'codex'\n  | 'github-copilot'\n  | 'gemini-cli'\n  | 'goose'\n  | 'amp'\n  | 'opencode'\n  | 'roo'\n\nexport interface AgentConfig {\n  name: AgentType\n  displayName: string\n  /** Project-level skills directory (e.g., .claude/skills) */\n  skillsDir: string\n  /** Global skills directory (e.g., ~/.claude/skills) */\n  globalSkillsDir: string | undefined\n  /** Check if agent is installed on the system */\n  detectInstalled: () => boolean\n}\n\nexport const agents: Record<AgentType, AgentConfig> = {\n  'claude-code': {\n    name: 'claude-code',\n    displayName: 'Claude Code',\n    skillsDir: '.claude/skills',\n    globalSkillsDir: join(claudeHome, 'skills'),\n    detectInstalled: () => existsSync(claudeHome),\n  },\n  cursor: {\n    name: 'cursor',\n    displayName: 'Cursor',\n    skillsDir: '.cursor/skills',\n    globalSkillsDir: join(home, '.cursor/skills'),\n    detectInstalled: () => existsSync(join(home, '.cursor')),\n  },\n  windsurf: {\n    name: 'windsurf',\n    displayName: 'Windsurf',\n    skillsDir: '.windsurf/skills',\n    globalSkillsDir: join(home, '.codeium/windsurf/skills'),\n    detectInstalled: () => existsSync(join(home, '.codeium/windsurf')),\n  },\n  cline: {\n    name: 'cline',\n    displayName: 'Cline',\n    skillsDir: '.cline/skills',\n    globalSkillsDir: join(home, '.cline/skills'),\n    detectInstalled: () => existsSync(join(home, '.cline')),\n  },\n  codex: {\n    name: 'codex',\n    displayName: 'Codex',\n    skillsDir: '.codex/skills',\n    globalSkillsDir: join(codexHome, 'skills'),\n    detectInstalled: () => existsSync(codexHome),\n  },\n  'github-copilot': {\n    name: 'github-copilot',\n    displayName: 'GitHub Copilot',\n    skillsDir: '.github/skills',\n    globalSkillsDir: join(home, '.copilot/skills'),\n    detectInstalled: () => existsSync(join(home, '.copilot')),\n  },\n  'gemini-cli': {\n    name: 'gemini-cli',\n    displayName: 'Gemini CLI',\n    skillsDir: '.gemini/skills',\n    globalSkillsDir: join(home, '.gemini/skills'),\n    detectInstalled: () => existsSync(join(home, '.gemini')),\n  },\n  goose: {\n    name: 'goose',\n    displayName: 'Goose',\n    skillsDir: '.goose/skills',\n    globalSkillsDir: join(configHome, 'goose/skills'),\n    detectInstalled: () => existsSync(join(configHome, 'goose')),\n  },\n  amp: {\n    name: 'amp',\n    displayName: 'Amp',\n    skillsDir: '.agents/skills',\n    globalSkillsDir: join(configHome, 'agents/skills'),\n    detectInstalled: () => existsSync(join(configHome, 'amp')),\n  },\n  opencode: {\n    name: 'opencode',\n    displayName: 'OpenCode',\n    skillsDir: '.opencode/skills',\n    globalSkillsDir: join(configHome, 'opencode/skills'),\n    detectInstalled: () => existsSync(join(configHome, 'opencode')),\n  },\n  roo: {\n    name: 'roo',\n    displayName: 'Roo Code',\n    skillsDir: '.roo/skills',\n    globalSkillsDir: join(home, '.roo/skills'),\n    detectInstalled: () => existsSync(join(home, '.roo')),\n  },\n}\n\n/**\n * Detect which agents are installed on the system\n */\nexport function detectInstalledAgents(): AgentType[] {\n  return Object.entries(agents)\n    .filter(([_, config]) => config.detectInstalled())\n    .map(([type]) => type as AgentType)\n}\n\n/**\n * Detect which agent is currently running this command\n * Returns the active agent based on environment variables and context\n */\nexport function detectCurrentAgent(): AgentType | null {\n  // Check environment variables set by agents\n  if (process.env.CLAUDE_CODE || process.env.CLAUDE_CONFIG_DIR) {\n    return 'claude-code'\n  }\n  if (process.env.CURSOR_SESSION || process.env.CURSOR_TRACE_ID) {\n    return 'cursor'\n  }\n  if (process.env.WINDSURF_SESSION) {\n    return 'windsurf'\n  }\n  if (process.env.CLINE_TASK_ID) {\n    return 'cline'\n  }\n  if (process.env.CODEX_HOME || process.env.CODEX_SESSION) {\n    return 'codex'\n  }\n  if (process.env.GITHUB_COPILOT_SESSION) {\n    return 'github-copilot'\n  }\n  if (process.env.GEMINI_API_KEY && process.env.GEMINI_SESSION) {\n    return 'gemini-cli'\n  }\n  if (process.env.GOOSE_SESSION) {\n    return 'goose'\n  }\n  if (process.env.AMP_SESSION) {\n    return 'amp'\n  }\n  if (process.env.OPENCODE_SESSION) {\n    return 'opencode'\n  }\n  if (process.env.ROO_SESSION) {\n    return 'roo'\n  }\n\n  // Check for project-level agent config directories\n  const cwd = process.cwd()\n  if (existsSync(join(cwd, '.claude'))) {\n    return 'claude-code'\n  }\n  if (existsSync(join(cwd, '.cursor'))) {\n    return 'cursor'\n  }\n  if (existsSync(join(cwd, '.windsurf'))) {\n    return 'windsurf'\n  }\n  if (existsSync(join(cwd, '.cline'))) {\n    return 'cline'\n  }\n\n  return null\n}\n\n/**\n * Sanitize skill name for filesystem\n */\nexport function sanitizeName(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9._]+/g, '-')\n    .replace(/^[.\\-]+|[.\\-]+$/g, '')\n    .slice(0, 255) || 'unnamed-skill'\n}\n\n/**\n * Install a skill directly to agent skill directories\n * Writes to each agent's skill folder in the project (e.g., .claude/skills/package-name/)\n */\nexport function installSkillForAgents(\n  skillName: string,\n  skillContent: string,\n  options: {\n    global?: boolean\n    cwd?: string\n    agents?: AgentType[]\n    /** Additional files to write (filename -> content) */\n    files?: Record<string, string>\n  } = {},\n): { installed: AgentType[], paths: string[] } {\n  const isGlobal = options.global ?? false\n  const cwd = options.cwd || process.cwd()\n  const sanitized = sanitizeName(skillName)\n\n  // Use specified agents or detect installed\n  const targetAgents = options.agents || detectInstalledAgents()\n\n  const installed: AgentType[] = []\n  const paths: string[] = []\n\n  for (const agentType of targetAgents) {\n    const agent = agents[agentType]\n\n    // Skip if agent doesn't support global installation\n    if (isGlobal && !agent.globalSkillsDir) continue\n\n    // Determine target directory\n    const baseDir = isGlobal ? agent.globalSkillsDir! : join(cwd, agent.skillsDir)\n    const skillDir = join(baseDir, sanitized)\n\n    // Create directory and write files\n    mkdirSync(skillDir, { recursive: true })\n    writeFileSync(join(skillDir, 'SKILL.md'), skillContent)\n\n    // Write additional files\n    if (options.files) {\n      for (const [filename, content] of Object.entries(options.files)) {\n        writeFileSync(join(skillDir, filename), content)\n      }\n    }\n\n    installed.push(agentType)\n    paths.push(skillDir)\n  }\n\n  return { installed, paths }\n}\n\nexport interface SkillMetadata {\n  name: string\n  version?: string\n  description?: string\n}\n\n/**\n * Generate SKILL.md frontmatter content\n * The description tells the agent when to use this skill\n */\nexport function generateSkillMd(\n  meta: SkillMetadata,\n  body: string,\n): string {\n  const { name, version, description: packageDescription } = meta\n\n  // Create an actionable description that tells the agent when to use this skill\n  const description = packageDescription\n    ? `${packageDescription} Use this skill when working with ${name}, importing from \"${name}\", or when the user asks about ${name} features, API, or usage.`\n    : `Documentation for ${name}. Use this skill when working with ${name} or importing from \"${name}\".`\n\n  const frontmatter = [\n    '---',\n    `name: ${name}`,\n    `description: ${description}`,\n  ]\n\n  if (version) {\n    frontmatter.push(`version: \"${version}\"`)\n  }\n\n  frontmatter.push('---')\n\n  return frontmatter.join('\\n') + '\\n\\n' + body\n}\n"],"mappings":"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"}